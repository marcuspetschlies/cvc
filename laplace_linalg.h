#ifndef _LAPLACE_LINALG_H
#define _LAPLACE_LINALG_H
#include <math.h>
#include "cvc_complex.h"
#include "cvc_linalg.h"
/* color dimension: 3 */
#define _cv_eq_zero(_r) {\
(_r)[ 0] = 0.;\
(_r)[ 1] = 0.;\
(_r)[ 2] = 0.;\
(_r)[ 3] = 0.;\
(_r)[ 4] = 0.;\
(_r)[ 5] = 0.;\
}


#define _cv_eq_cv(_r, _s) {\
(_r)[ 0] = (_s)[ 0];\
(_r)[ 1] = (_s)[ 1];\
(_r)[ 2] = (_s)[ 2];\
(_r)[ 3] = (_s)[ 3];\
(_r)[ 4] = (_s)[ 4];\
(_r)[ 5] = (_s)[ 5];\
}


#define _cv_pl_eq_cv(_r, _s) {\
(_r)[ 0] += (_s)[ 0];\
(_r)[ 1] += (_s)[ 1];\
(_r)[ 2] += (_s)[ 2];\
(_r)[ 3] += (_s)[ 3];\
(_r)[ 4] += (_s)[ 4];\
(_r)[ 5] += (_s)[ 5];\
}


#define _cv_eq_cv_pl_cv(_r, _s, _t) {\
(_r)[ 0] = (_s)[ 0] + (_t)[ 0];\
(_r)[ 1] = (_s)[ 1] + (_t)[ 1];\
(_r)[ 2] = (_s)[ 2] + (_t)[ 2];\
(_r)[ 3] = (_s)[ 3] + (_t)[ 3];\
(_r)[ 4] = (_s)[ 4] + (_t)[ 4];\
(_r)[ 5] = (_s)[ 5] + (_t)[ 5];\
}


#define _cv_mi_eq_cv(_r, _s) {\
(_r)[ 0] -= (_s)[ 0];\
(_r)[ 1] -= (_s)[ 1];\
(_r)[ 2] -= (_s)[ 2];\
(_r)[ 3] -= (_s)[ 3];\
(_r)[ 4] -= (_s)[ 4];\
(_r)[ 5] -= (_s)[ 5];\
}


#define _cv_eq_cv_ti_re(_r, _s, _c) {\
(_r)[ 0] = (_s)[ 0] * (_c);\
(_r)[ 1] = (_s)[ 1] * (_c);\
(_r)[ 2] = (_s)[ 2] * (_c);\
(_r)[ 3] = (_s)[ 3] * (_c);\
(_r)[ 4] = (_s)[ 4] * (_c);\
(_r)[ 5] = (_s)[ 5] * (_c);\
}


#define _cv_ti_eq_re(_r, _c) {\
(_r)[ 0] *= (_c);\
(_r)[ 1] *= (_c);\
(_r)[ 2] *= (_c);\
(_r)[ 3] *= (_c);\
(_r)[ 4] *= (_c);\
(_r)[ 5] *= (_c);\
}


#define _cv_eq_cv_ti_im(_r, _s, _c) {\
(_r)[ 0] = -(_s)[ 1] * (_c);\
(_r)[ 1] = +(_s)[ 0] * (_c);\
(_r)[ 2] = -(_s)[ 3] * (_c);\
(_r)[ 3] = +(_s)[ 2] * (_c);\
(_r)[ 4] = -(_s)[ 5] * (_c);\
(_r)[ 5] = +(_s)[ 4] * (_c);\
}


#define _cv_eq_cv_ti_co(_r, _s, _c) {\
(_r)[ 0] = +(_s)[ 0] * (_c).re - (_s)[ 1] * (_c).im;\
(_r)[ 1] = +(_s)[ 0] * (_c).im + (_s)[ 1] * (_c).re;\
(_r)[ 2] = +(_s)[ 2] * (_c).re - (_s)[ 3] * (_c).im;\
(_r)[ 3] = +(_s)[ 2] * (_c).im + (_s)[ 3] * (_c).re;\
(_r)[ 4] = +(_s)[ 4] * (_c).re - (_s)[ 5] * (_c).im;\
(_r)[ 5] = +(_s)[ 4] * (_c).im + (_s)[ 5] * (_c).re;\
}


#define _cv_eq_cm_ti_cv(_r, _g, _s) {\
(_r)[ 0] = 0.;\
(_r)[ 1] = 0.;\
(_r)[ 0] += (_g)[ 0] * (_s)[ 0] - (_g)[ 1] * (_s)[ 1];\
(_r)[ 1] += (_g)[ 1] * (_s)[ 0] + (_g)[ 0] * (_s)[ 1];\
(_r)[ 0] += (_g)[ 2] * (_s)[ 2] - (_g)[ 3] * (_s)[ 3];\
(_r)[ 1] += (_g)[ 3] * (_s)[ 2] + (_g)[ 2] * (_s)[ 3];\
(_r)[ 0] += (_g)[ 4] * (_s)[ 4] - (_g)[ 5] * (_s)[ 5];\
(_r)[ 1] += (_g)[ 5] * (_s)[ 4] + (_g)[ 4] * (_s)[ 5];\
(_r)[ 2] = 0.;\
(_r)[ 3] = 0.;\
(_r)[ 2] += (_g)[ 6] * (_s)[ 0] - (_g)[ 7] * (_s)[ 1];\
(_r)[ 3] += (_g)[ 7] * (_s)[ 0] + (_g)[ 6] * (_s)[ 1];\
(_r)[ 2] += (_g)[ 8] * (_s)[ 2] - (_g)[ 9] * (_s)[ 3];\
(_r)[ 3] += (_g)[ 9] * (_s)[ 2] + (_g)[ 8] * (_s)[ 3];\
(_r)[ 2] += (_g)[10] * (_s)[ 4] - (_g)[11] * (_s)[ 5];\
(_r)[ 3] += (_g)[11] * (_s)[ 4] + (_g)[10] * (_s)[ 5];\
(_r)[ 4] = 0.;\
(_r)[ 5] = 0.;\
(_r)[ 4] += (_g)[12] * (_s)[ 0] - (_g)[13] * (_s)[ 1];\
(_r)[ 5] += (_g)[13] * (_s)[ 0] + (_g)[12] * (_s)[ 1];\
(_r)[ 4] += (_g)[14] * (_s)[ 2] - (_g)[15] * (_s)[ 3];\
(_r)[ 5] += (_g)[15] * (_s)[ 2] + (_g)[14] * (_s)[ 3];\
(_r)[ 4] += (_g)[16] * (_s)[ 4] - (_g)[17] * (_s)[ 5];\
(_r)[ 5] += (_g)[17] * (_s)[ 4] + (_g)[16] * (_s)[ 5];\
}

/* _r += _g * _s */
#define _cv_pl_eq_cm_ti_cv(_r, _g, _s) {\
(_r)[ 0] += (_g)[ 0] * (_s)[ 0] - (_g)[ 1] * (_s)[ 1];\
(_r)[ 1] += (_g)[ 1] * (_s)[ 0] + (_g)[ 0] * (_s)[ 1];\
(_r)[ 0] += (_g)[ 2] * (_s)[ 2] - (_g)[ 3] * (_s)[ 3];\
(_r)[ 1] += (_g)[ 3] * (_s)[ 2] + (_g)[ 2] * (_s)[ 3];\
(_r)[ 0] += (_g)[ 4] * (_s)[ 4] - (_g)[ 5] * (_s)[ 5];\
(_r)[ 1] += (_g)[ 5] * (_s)[ 4] + (_g)[ 4] * (_s)[ 5];\
(_r)[ 2] += (_g)[ 6] * (_s)[ 0] - (_g)[ 7] * (_s)[ 1];\
(_r)[ 3] += (_g)[ 7] * (_s)[ 0] + (_g)[ 6] * (_s)[ 1];\
(_r)[ 2] += (_g)[ 8] * (_s)[ 2] - (_g)[ 9] * (_s)[ 3];\
(_r)[ 3] += (_g)[ 9] * (_s)[ 2] + (_g)[ 8] * (_s)[ 3];\
(_r)[ 2] += (_g)[10] * (_s)[ 4] - (_g)[11] * (_s)[ 5];\
(_r)[ 3] += (_g)[11] * (_s)[ 4] + (_g)[10] * (_s)[ 5];\
(_r)[ 4] += (_g)[12] * (_s)[ 0] - (_g)[13] * (_s)[ 1];\
(_r)[ 5] += (_g)[13] * (_s)[ 0] + (_g)[12] * (_s)[ 1];\
(_r)[ 4] += (_g)[14] * (_s)[ 2] - (_g)[15] * (_s)[ 3];\
(_r)[ 5] += (_g)[15] * (_s)[ 2] + (_g)[14] * (_s)[ 3];\
(_r)[ 4] += (_g)[16] * (_s)[ 4] - (_g)[17] * (_s)[ 5];\
(_r)[ 5] += (_g)[17] * (_s)[ 4] + (_g)[16] * (_s)[ 5];\
}

#define _cv_eq_cm_dag_ti_cv(_r, _g, _s) {\
(_r)[ 0] = 0.;\
(_r)[ 1] = 0.;\
(_r)[ 0] +=  (_g)[ 0] * (_s)[ 0] + (_g)[ 1] * (_s)[ 1];\
(_r)[ 1] += -(_g)[ 1] * (_s)[ 0] + (_g)[ 0] * (_s)[ 1];\
(_r)[ 0] +=  (_g)[ 6] * (_s)[ 2] + (_g)[ 7] * (_s)[ 3];\
(_r)[ 1] += -(_g)[ 7] * (_s)[ 2] + (_g)[ 6] * (_s)[ 3];\
(_r)[ 0] +=  (_g)[12] * (_s)[ 4] + (_g)[13] * (_s)[ 5];\
(_r)[ 1] += -(_g)[13] * (_s)[ 4] + (_g)[12] * (_s)[ 5];\
(_r)[ 2] = 0.;\
(_r)[ 3] = 0.;\
(_r)[ 2] +=  (_g)[ 2] * (_s)[ 0] + (_g)[ 3] * (_s)[ 1];\
(_r)[ 3] += -(_g)[ 3] * (_s)[ 0] + (_g)[ 2] * (_s)[ 1];\
(_r)[ 2] +=  (_g)[ 8] * (_s)[ 2] + (_g)[ 9] * (_s)[ 3];\
(_r)[ 3] += -(_g)[ 9] * (_s)[ 2] + (_g)[ 8] * (_s)[ 3];\
(_r)[ 2] +=  (_g)[14] * (_s)[ 4] + (_g)[15] * (_s)[ 5];\
(_r)[ 3] += -(_g)[15] * (_s)[ 4] + (_g)[14] * (_s)[ 5];\
(_r)[ 4] = 0.;\
(_r)[ 5] = 0.;\
(_r)[ 4] +=  (_g)[ 4] * (_s)[ 0] + (_g)[ 5] * (_s)[ 1];\
(_r)[ 5] += -(_g)[ 5] * (_s)[ 0] + (_g)[ 4] * (_s)[ 1];\
(_r)[ 4] +=  (_g)[10] * (_s)[ 2] + (_g)[11] * (_s)[ 3];\
(_r)[ 5] += -(_g)[11] * (_s)[ 2] + (_g)[10] * (_s)[ 3];\
(_r)[ 4] +=  (_g)[16] * (_s)[ 4] + (_g)[17] * (_s)[ 5];\
(_r)[ 5] += -(_g)[17] * (_s)[ 4] + (_g)[16] * (_s)[ 5];\
}

/* _r += _g^+ _s */
#define _cv_pl_eq_cm_dag_ti_cv(_r, _g, _s) {\
(_r)[ 0] +=  (_g)[ 0] * (_s)[ 0] + (_g)[ 1] * (_s)[ 1];\
(_r)[ 1] += -(_g)[ 1] * (_s)[ 0] + (_g)[ 0] * (_s)[ 1];\
(_r)[ 0] +=  (_g)[ 6] * (_s)[ 2] + (_g)[ 7] * (_s)[ 3];\
(_r)[ 1] += -(_g)[ 7] * (_s)[ 2] + (_g)[ 6] * (_s)[ 3];\
(_r)[ 0] +=  (_g)[12] * (_s)[ 4] + (_g)[13] * (_s)[ 5];\
(_r)[ 1] += -(_g)[13] * (_s)[ 4] + (_g)[12] * (_s)[ 5];\
(_r)[ 2] +=  (_g)[ 2] * (_s)[ 0] + (_g)[ 3] * (_s)[ 1];\
(_r)[ 3] += -(_g)[ 3] * (_s)[ 0] + (_g)[ 2] * (_s)[ 1];\
(_r)[ 2] +=  (_g)[ 8] * (_s)[ 2] + (_g)[ 9] * (_s)[ 3];\
(_r)[ 3] += -(_g)[ 9] * (_s)[ 2] + (_g)[ 8] * (_s)[ 3];\
(_r)[ 2] +=  (_g)[14] * (_s)[ 4] + (_g)[15] * (_s)[ 5];\
(_r)[ 3] += -(_g)[15] * (_s)[ 4] + (_g)[14] * (_s)[ 5];\
(_r)[ 4] +=  (_g)[ 4] * (_s)[ 0] + (_g)[ 5] * (_s)[ 1];\
(_r)[ 5] += -(_g)[ 5] * (_s)[ 0] + (_g)[ 4] * (_s)[ 1];\
(_r)[ 4] +=  (_g)[10] * (_s)[ 2] + (_g)[11] * (_s)[ 3];\
(_r)[ 5] += -(_g)[11] * (_s)[ 2] + (_g)[10] * (_s)[ 3];\
(_r)[ 4] +=  (_g)[16] * (_s)[ 4] + (_g)[17] * (_s)[ 5];\
(_r)[ 5] += -(_g)[17] * (_s)[ 4] + (_g)[16] * (_s)[ 5];\
}

#define _cv_printf(_r, _name, _ofs) {\
fprintf( (_ofs), "%s[%d] <- (%25.16e) + (%25.16ei)\n", (_name), 1, (_r)[ 0], (_r)[ 1]);\
fprintf( (_ofs), "%s[%d] <- (%25.16e) + (%25.16ei)\n", (_name), 2, (_r)[ 2], (_r)[ 3]);\
fprintf( (_ofs), "%s[%d] <- (%25.16e) + (%25.16ei)\n", (_name), 3, (_r)[ 4], (_r)[ 5]);\
fprintf( (_ofs), "\n\n");\
}


#define _co_eq_cv_dag_ti_cv(_c, _r, _s) {\
(_c)->re = 0.;\
(_c)->im = 0.;\
(_c)->re +=  (_r)[ 0] * (_s)[ 0] + (_r)[ 1] * (_s)[ 1];\
(_c)->im += -(_r)[ 1] * (_s)[ 0] + (_r)[ 0] * (_s)[ 1];\
(_c)->re +=  (_r)[ 2] * (_s)[ 2] + (_r)[ 3] * (_s)[ 3];\
(_c)->im += -(_r)[ 3] * (_s)[ 2] + (_r)[ 2] * (_s)[ 3];\
(_c)->re +=  (_r)[ 4] * (_s)[ 4] + (_r)[ 5] * (_s)[ 5];\
(_c)->im += -(_r)[ 5] * (_s)[ 4] + (_r)[ 4] * (_s)[ 5];\
}



/* triple product of three color vectors */
#if 0
#define _co_eq_cv_dot_cv_cross_cv(_c, _u, _v, _w) {\
  double _a_re, _a_im;\
  _a_re = ( (_v)[2] * (_w[4]) - (_v)[4] * (_w)[2] ) - ( (_v)[3] * (_w[5]) - (_v)[5] * (_w)[3] );\
  _a_im = ( (_v)[2] * (_w[5]) - (_v)[4] * (_w)[3] ) + ( (_v)[3] * (_w[4]) - (_v)[5] * (_w)[2] );\
  (_c)[0] = (_u)[0] * _a_re - (_u)[1] * _a_im;\
  (_c)[1] = (_u)[1] * _a_re + (_u)[0] * _a_im;\
  _a_re = ( (_v)[4] * (_w[0]) - (_v)[0] * (_w)[4] ) - ( (_v)[5] * (_w[1]) - (_v)[1] * (_w)[5] );\
  _a_im = ( (_v)[4] * (_w[1]) - (_v)[0] * (_w)[5] ) + ( (_v)[5] * (_w[0]) - (_v)[1] * (_w)[4] );\
  (_c)[0] += (_u)[2] * _a_re - (_u)[3] * _a_im;\
  (_c)[1] += (_u)[3] * _a_re + (_u)[2] * _a_im;\
  _a_re = ( (_v)[0] * (_w[2]) - (_v)[2] * (_w)[0] ) - ( (_v)[1] * (_w[3]) - (_v)[3] * (_w)[1] );\
  _a_im = ( (_v)[0] * (_w[3]) - (_v)[2] * (_w)[1] ) + ( (_v)[1] * (_w[2]) - (_v)[3] * (_w)[0] );\
  (_c)[0] += (_u)[4] * _a_re - (_u)[4] * _a_im;\
  (_c)[1] += (_u)[5] * _a_re + (_u)[5] * _a_im;\
}
#endif

inline void _co_eq_cv_dot_cv_cross_cv(double *_c, double *_u, double *_v, double *_w) {
  double _a_re, _a_im;
  (_c)[0] = 0.;
  (_c)[1] = 0.;
/*
  _a_re = ( (_v)[2] * (_w[4]) - (_v)[4] * (_w)[2] ) - ( (_v)[3] * (_w[5]) - (_v)[5] * (_w)[3] );
  _a_im = ( (_v)[2] * (_w[5]) - (_v)[4] * (_w)[3] ) + ( (_v)[3] * (_w[4]) - (_v)[5] * (_w)[2] );

  (_c)[0] = (_u)[0] * _a_re - (_u)[1] * _a_im;
  (_c)[1] = (_u)[1] * _a_re + (_u)[0] * _a_im;

  _a_re = ( (_v)[4] * (_w[0]) - (_v)[0] * (_w)[4] ) - ( (_v)[5] * (_w[1]) - (_v)[1] * (_w)[5] );
  _a_im = ( (_v)[4] * (_w[1]) - (_v)[0] * (_w)[5] ) + ( (_v)[5] * (_w[0]) - (_v)[1] * (_w)[4] );

  (_c)[0] += (_u)[2] * _a_re - (_u)[3] * _a_im;
  (_c)[1] += (_u)[3] * _a_re + (_u)[2] * _a_im;

  _a_re = ( (_v)[0] * (_w[2]) - (_v)[2] * (_w)[0] ) - ( (_v)[1] * (_w[3]) - (_v)[3] * (_w)[1] );
  _a_im = ( (_v)[0] * (_w[3]) - (_v)[2] * (_w)[1] ) + ( (_v)[1] * (_w[2]) - (_v)[3] * (_w)[0] );

  (_c)[0] += (_u)[4] * _a_re - (_u)[5] * _a_im;
  (_c)[1] += (_u)[5] * _a_re + (_u)[4] * _a_im;
*/

  _a_re = ( (_v)[2] * (_w)[4] - (_v)[4] * (_w)[2] ) - ( (_v)[3] * (_w)[5] - (_v)[5] * (_w)[3] );
  _a_im = ( (_v)[2] * (_w)[5] - (_v)[4] * (_w)[3] ) + ( (_v)[3] * (_w)[4] - (_v)[5] * (_w)[2] );

  (_c)[0] += (_u)[0] * _a_re - (_u)[1] * _a_im;
  (_c)[1] += (_u)[1] * _a_re + (_u)[0] * _a_im;

  _a_re = ( (_v)[4] * (_w)[0] - (_v)[0] * (_w)[4] ) - ( (_v)[5] * (_w)[1] - (_v)[1] * (_w)[5] );
  _a_im = ( (_v)[4] * (_w)[1] - (_v)[0] * (_w)[5] ) + ( (_v)[5] * (_w)[0] - (_v)[1] * (_w)[4] );

  (_c)[0] += (_u)[2] * _a_re - (_u)[3] * _a_im;
  (_c)[1] += (_u)[3] * _a_re + (_u)[2] * _a_im;

  _a_re = ( (_v)[0] * (_w)[2] - (_v)[2] * (_w)[0] ) - ( (_v)[1] * (_w)[3] - (_v)[3] * (_w)[1] );
  _a_im = ( (_v)[0] * (_w)[3] - (_v)[2] * (_w)[1] ) + ( (_v)[1] * (_w)[2] - (_v)[3] * (_w)[0] );

  (_c)[0] += (_u)[4] * _a_re - (_u)[5] * _a_im;
  (_c)[1] += (_u)[5] * _a_re + (_u)[4] * _a_im;



}


#endif
